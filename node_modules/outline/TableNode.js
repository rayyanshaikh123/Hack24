'use strict';var r=require("outline");function v(a,...e){e.forEach(g=>{null!=g&&"string"===typeof g&&a.classList.add(...g.split(" "))})}const x=document.createElement("style");x.appendChild(document.createTextNode("::selection{background-color: transparent}"));function A(a){for(;null!=a;){const e=a.nodeName;if("TD"===e||"TH"===e){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function B(a){const e=[],g={rows:0,columns:0,cells:e};(new MutationObserver(b=>{var d=a.firstChild;let h=0,f=0,n=!1;for(let k=0;k<b.length;k++){const l=b[k].target.nodeName;if("TABLE"===l||"TR"===l){n=!0;break}}if(n){for(e.length=0;null!=d;){b=d.nodeName;if("TD"===b||"TH"===b)b={elem:d,highlighted:!1,x:h,y:f},d._cell=b,void 0===e[f]&&(e[f]=[]),e[f][h]=b;else if(b=d.firstChild,null!=b){d=b;continue}b=d.nextSibling;if(null!=b)h++,d=b;else if(b=d.parentNode,null!=b){d=b.nextSibling;if(null==d)break;
f++;h=0}}g.columns=h+1;g.rows=f+1}})).observe(a,{childList:!0,subtree:!0});return g}function C(a,e,g,b,d){const h=[];for(let f=0;f<d.length;f++){const n=d[f];for(let k=0;k<n.length;k++){const l=n[k],q=l.elem.style;k>=a&&k<=e&&f>=g&&f<=b?(l.highlighted||(l.highlighted=!0,q.setProperty("background-color","rgb(163, 187, 255)"),q.setProperty("caret-color","transparent")),h.push(l)):l.highlighted&&(l.highlighted=!1,q.removeProperty("background-color"),q.removeProperty("caret-color"))}}return h}
function D(a,e,g){const b=B(e);if(null!==g.getRootElement()){var d=!1,h=!1,f=-1,n=-1,k=-1,l=-1,q=[];e.addEventListener("mousemove",m=>{if(d){var c=A(m.target);if(null!==c){m.preventDefault();m=c.x;c=c.y;if(!h&&(f!==m||n!==c)){const t=window.getSelection();t.setBaseAndExtent(t.anchorNode,0,t.anchorNode,0);h=!0;document.body&&document.body.appendChild(x);null===u&&(u=g.addListener("command",(w,y)=>{if("deleteCharacter"===w){if(q.length===b.columns*b.rows)return a.selectPrevious(),a.remove(),z(),!0;
q.forEach(({elem:p})=>{p=r.$getNearestNodeFromDOMNode(p);r.$isElementNode(p)&&p.clear()});return!0}return"formatText"===w?(F(y),!0):!1},1))}else if(m===k&&c===l)return;k=m;l=c;h&&(q=C(Math.min(f,k),Math.max(f,k),Math.min(n,l),Math.max(n,l),b.cells))}}});var z=()=>{d=h=!1;l=k=n=f=-1;C(-1,-1,-1,-1,b.cells);q=[];null!==u&&(u(),u=null);const m=x.parentNode;null!=m&&m.removeChild(x)};e.addEventListener("mouseleave",()=>{});var F=m=>{let c=r.$getSelection();null===c&&(c=r.$createSelection());const t=c,
w=t.anchor,y=t.focus;q.forEach(p=>{p=r.$getNearestNodeFromDOMNode(p.elem);r.$isElementNode(p)&&(w.set(p.getKey(),0,"element"),y.set(p.getKey(),p.getChildrenSize(),"element"),t.formatText(m))});c.anchor.set(c.anchor.key,c.anchor.offset,c.anchor.type);c.focus.set(c.anchor.key,c.anchor.offset,c.anchor.type);r.$setSelection(c)},u=null;e.addEventListener("mousedown",m=>{d?h&&z():setTimeout(()=>{h&&z();const c=A(m.target);null!==c&&(d=!0,f=c.x,n=c.y,document.addEventListener("mouseup",()=>{d=!1},{capture:!0,
once:!0}))},0)})}}class E extends r.ElementNode{static getType(){return"table"}static clone(a){return new E(a.__key)}constructor(a){super(a)}createDOM(a,e){const g=document.createElement("table");v(g,a.theme.table);D(this,g,e);return g}updateDOM(){return!1}canExtractContents(){return!1}canBeEmpty(){return!1}}exports.$createTableNode=function(){return new E};exports.$isTableNode=function(a){return a instanceof E};exports.TableNode=E;
