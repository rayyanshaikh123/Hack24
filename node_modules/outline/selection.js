'use strict';var l=require("outline");const r=new Map;function v(a){a=a.getLatest();const c=a.constructor.clone(a);c.__parent=a.__parent;l.$isElementNode(a)&&l.$isElementNode(c)?(c.__children=Array.from(a.__children),c.__format=a.__format,c.__indent=a.__indent,c.__dir=a.__dir):l.$isTextNode(a)&&l.$isTextNode(c)?(c.__format=a.__format,c.__style=a.__style,c.__mode=a.__mode,c.__detail=a.__detail):l.$isDecoratorNode(a)&&l.$isDecoratorNode(c)&&(c.__ref=a.__ref);return c}
function w(a,c,b,f,h){for(var e=c;null!==a;){for(c=a.getParent();null!==c&&c.excludeFromCopy();)c=c.getParent();if(null===c)break;if(!l.$isElementNode(a)||!a.excludeFromCopy()){const d=a.getKey();let g=h.get(d);const k=void 0===g;k&&(g=v(a),h.set(d,g));!l.$isTextNode(g)||g.isSegmented()||g.isToken()?l.$isElementNode(g)&&(g.__children=g.__children.slice(b?e:0,b?void 0:e+1)):g.__text=g.__text.slice(b?e:0,b?void 0:e);if(l.$isRootNode(c)){k&&f.push(d);break}}e=h.get(c.getKey());e=l.$isElementNode(e)?
e.__children.indexOf(a.getKey()):a.getIndexWithinParent();a=c}}function x(a){return r.get(a)||null}function y(a,c){var b=x(a.getStyle());c=b?{...b,...c}:c;b="";for(f in c)f&&(b+=`${f}: ${c[f]};`);var f=b;a.setStyle(f);r.set(f,c)}function z(a,c,b,f){a.modify(c?"extend":"move",b,f)}function A(a){for(;null!==a&&!l.$isRootNode(a);){const c=a.getLatest(),b=a.getParent();0===c.__children.length&&a.remove();a=b}}
exports.$cloneContents=function(a){var c=a.anchor,b=a.focus,f=c.getCharacterOffset();const h=b.getCharacterOffset();var e=c.getNode(),d=b.getNode(),g=e.getParentOrThrow();if(e===d&&l.$isTextNode(e)&&(g.canBeEmpty()||1<g.getChildrenSize()))return a=v(e),e=h>f,a.__text=a.__text.slice(e?f:h,e?h:f),f=a.getKey(),{range:[f],nodeMap:[[f,a]]};a=a.getNodes();if(0===a.length)return{range:[],nodeMap:[]};e=a.length;d=a[0];g=d.getParent();if(null!==g&&!g.canBeEmpty()){var k=g.__children;if(k.length===e){var m=
!0;for(var n=0;n<k.length;n++)if(k[n]!==a[n].__key){m=!1;break}m&&(e++,a.push(g))}}g=a[e-1];c=c.isBefore(b);b=new Map;k=[];w(d,c?f:h,!0,k,b);for(d=0;d<e;d++)if(m=a[d],n=m.getKey(),!(b.has(n)||l.$isElementNode(m)&&m.excludeFromCopy())){const t=v(m);l.$isRootNode(m.getParent())&&k.push(m.getKey());b.set(n,t)}w(g,c?h:f,!1,k,b);return{range:k,nodeMap:Array.from(b.entries())}};
exports.$getSelectionStyleValueForProperty=function(a,c,b=""){let f=null;const h=a.getNodes();var e=a.anchor,d=a.focus,g=a.isBackward();a=g?d.offset:e.offset;e=g?d.getNode():e.getNode();for(d=0;d<h.length;d++){var k=h[d];if((0===d||0!==a||!k.is(e))&&l.$isTextNode(k)){g=c;var m=b;k=k.getStyle();k=x(k);g=null!==k?k[g]||m:m;if(null===f)f=g;else if(f!==g){f="";break}}}return null===f?b:f};
exports.$insertRichText=function(a,c){const b=c.split(/\r?\n/);if(1===b.length)a.insertText(c);else{c=[];const f=b.length;for(let h=0;h<f;h++){const e=b[h];""!==e&&c.push(l.$createTextNode(e));h!==f-1&&c.push(l.$createLineBreakNode())}a.insertNodes(c)}};exports.$isAtNodeEnd=function(a){return"text"===a.type?a.offset===a.getNode().getTextContentSize():a.offset===a.getNode().getChildrenSize()};exports.$moveCaretSelection=z;
exports.$moveCharacter=function(a,c,b){var f="rtl"===a.anchor.getNode().getParentOrThrow().getDirection();z(a,c,b?!f:f,"character")};
exports.$patchStyleText=function(a,c){var b=a.getNodes();const f=b.length-1;let h=b[0],e=b[f];if(!a.isCollapsed()){var d=a.anchor,g=a.focus;a=h.getTextContent().length;var k=g.offset,m=d.offset;d=(g=d.isBefore(g))?m:k;g=g?k:m;if(d===h.getTextContentSize()){const n=h.getNextSibling();l.$isTextNode(n)&&(d=m=0,h=n)}if(h.is(e))l.$isTextNode(h)&&(d=m>k?k:m,g=m>k?m:k,d!==g&&(0===d&&g===a?(y(h,c),h.select(d,g)):(b=h.splitText(d,g),b=0===d?b[0]:b[1],y(b,c),b.select(0,g-d))));else for(l.$isTextNode(h)&&(0!==
d&&([,h]=h.splitText(d)),y(h,c)),l.$isTextNode(e)&&(a=e.getTextContent().length,g!==a&&([e]=e.splitText(g)),0!==g&&y(e,c)),a=1;a<f;a++)k=b[a],m=k.getKey(),l.$isTextNode(k)&&m!==h.getKey()&&m!==e.getKey()&&!k.isToken()&&y(k,c)}};
exports.$selectAll=function(a){const c=a.anchor;a=a.focus;var b=c.getNode().getTopLevelElementOrThrow().getParentOrThrow();let f=b.getFirstDescendant();b=b.getLastDescendant();let h="element",e="element",d=0;l.$isTextNode(f)?h="text":l.$isElementNode(f)||null===f||(f=f.getParentOrThrow());l.$isTextNode(b)?(e="text",d=b.getTextContentSize()):l.$isElementNode(b)||null===b||(b=b.getParentOrThrow(),d=b.getChildrenSize());f&&b&&(c.set(f.getKey(),0,h),a.set(b.getKey(),d,e))};
exports.$wrapLeafNodesInElements=function(a,c,b){const f=a.getNodes(),h=f.length;if(0===h){a=a.anchor;a="text"===a.type?a.getNode().getParentOrThrow():a.getNode();var e=a.getChildren();let p=c();e.forEach(u=>p.append(u));b&&(p=b.append(p));a.replace(p)}else{var d=f[0],g=new Map;e=[];for(d=l.$isElementNode(d)?d:d.getParentOrThrow();null!==d;){var k=d.getPreviousSibling();if(null!==k){d=k;break}d=d.getParentOrThrow();if(l.$isRootNode(d))break}k=new Set;for(var m=0;m<h;m++){var n=f[m];l.$isElementNode(n)&&
0===n.getChildrenSize()&&k.add(n.getKey())}var t=new Set;for(m=0;m<h;m++){var q=f[m];n=q.getParent();if(null!==n&&l.$isLeafNode(q)&&!t.has(q.getKey())){if(q=n.getKey(),void 0===g.get(q)){const p=c();e.push(p);g.set(q,p);n.getChildren().forEach(u=>{p.append(u);t.add(u.getKey())});A(n)}}else k.has(q.getKey())&&(e.push(c()),q.remove())}if(b)for(c=0;c<e.length;c++)b.append(e[c]);if(l.$isRootNode(d))if(c=d.getFirstChild(),l.$isElementNode(c)&&(d=c),null===c)if(b)d.append(b);else for(b=0;b<e.length;b++)d.append(e[b]);
else if(b)c.insertBefore(b);else for(b=0;b<e.length;b++)c.insertBefore(e[b]);else if(b)d.insertAfter(b);else for(b=e.length-1;0<=b;b--)d.insertAfter(e[b]);a.dirty=!0}};exports.getStyleObjectFromCSS=x;
